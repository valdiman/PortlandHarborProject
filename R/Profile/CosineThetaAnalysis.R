# Script to calculate Cosine theta for the air samples.
# average water profile, sediment profile and Aroclors

# Packages and libraries needed --------------------------------------------
# Install packages
install.packages("tidyr")
install.packages("dplyr")
install.packages("lsa")
install.packages("SnowballC")

# Libraries
{
  library(tidyr)
  library(dplyr)
  library(lsa) 
}

# Read data ---------------------------------------------------------------
# Air profiles
prof.air <- read.csv("Output/Data/csv/ProfAirV2.csv", header = TRUE,
                     check.names = FALSE)
# Water profile
prof.waterV0 <- read.csv("Output/Data/csv/AveProf3HWater.csv", header = TRUE,
                       check.names = FALSE)

prof.water <- as.data.frame(t(prof.waterV0$mean))
colnames(prof.water) <- prof.waterV0$congener

# Flux profile
prof.fluxV0 <- read.csv("Output/Data/csv/PCBFlux.csv", header = TRUE,
                       check.names = FALSE)

prof.flux <- as.data.frame(t(prof.fluxV0$`Mean (ng/m2/d)`))
colnames(prof.flux) <- prof.fluxV0$Congener


prof.sed <- c(PCB1 = 0.0124485, PCB2 = 0.0019972, PCB3 = 0.0053013, PCB4 = 0.0371992,
               PCB5 = 0.0011788, PCB6 = 0.0103043, PCB7 = 0.0020843, PCB8 = 0.0441581,
               PCB9 = 0.0037055, PCB10 = 0.0013225, PCB11 = 0.0379037, "PCB12+13" = 0.0017622,
               PCB14 = 0.0001615, PCB15 = 0.0088529, PCB16 = 0.0162889, PCB17 = 0.0158909,
               "PCB18+30" = 0.0376301, PCB19 = 0.0072553, "PCB20+28" = 0.0286944,
               "PCB21+33" = 0.0171805, PCB22 = 0.011106, PCB23 = 0.0001978, PCB24 = 0.0005876,
               PCB25 = 0.0025587, "PCB26+29" = 0.0056595, PCB27 = 0.0023477,
               PCB31 = 0.0276946, PCB32 = 0.0105714, PCB34 = 0.0002603, PCB35 = 0.0010778,
               PCB36 = 0.0001026, PCB37 = 0.0041839, PCB38 = 0.000067, PCB39 = 0.0001053,
               "PCB40+41+71" = 0.0121065, PCB42 = 0.006208, "PCB43+73" = 0.0154834,
               "PCB44+47+65" = 0.0286962, "PCB45+51" = 0.008542, PCB46 = 0.0019932,
               PCB48 = 0.0053341, "PCB49+69" = 0.0162949, "PCB50+53" = 0.0061162,
               PCB52 = 0.0235105, PCB54 = 0.0003481, PCB55 = 0.0001935, PCB56 = 0.0045778,
               PCB57 = 0.0005116, PCB58 = 0.0000673, "PCB59+62+75" = 0.0020223, PCB60 = 0.002556,
               "PCB61+70+74+76" = 0.0292696, PCB63 = 0.0007464, PCB64 = 0.0107667,
               PCB66 = 0.011903, PCB67 = 0.0004101, PCB68 = 0.0003862, PCB72 = 0.0001805,
               PCB77 = 0.0008548, PCB78 = 0.0000462, PCB79 = 0.0001717,
    PCB80 = 0.000135,
    PCB81 = 0.000321,
    PCB82 = 0.0022084,
    "PCB83+99" = 0.0119786,
    PCB84 = 0.0088211,
    "PCB85+116+117" = 0.0047041,
    "PCB86+87+97+109+119+125" = 0.0191365,
    "PCB88+91" = 0.004878,
    PCB89 = 0.0003468,
    "PCB90+101+113" = 0.0338068,
    PCB92 = 0.0064418,
    "PCB93+95+98+100+102" = 0.0390176,
    PCB94 = 0.0002782,
    PCB96 = 0.0004427,
    PCB103 = 0.0002945,
    PCB104 = 0.0000504,
    PCB105 = 0.0065065,
    PCB106 = 0.0000823,
    PCB107 = 0.001121,
    PCB108 = 0.0008143,
    "PCB110+115" = 0.0333992,
    PCB111 = 0.000047,
    PCB112 = 0.0000392,
    PCB114 = 0.0004365,
    PCB118 = 0.0173282,
    PCB120 = 0.0001811,
    PCB121 = 0.0000196,
    PCB122 = 0.0002791,
    PCB123 = 0.0003258,
    PCB126 = 0.0000966,
    PCB127 = 0.0000613,
    PCB128 = 0.0033094,
    "PCB129+138+163" = 0.0338735,
    PCB130 = 0.0018043,
    PCB131 = 0.0006512,
    PCB132 = 0.013017,
    PCB133 = 0.0005924,
    PCB134 = 0.0024865,
    "PCB135+151+154" = 0.0194597,
    PCB136 = 0.0082528,
    PCB137 = 0.0011158,
    "PCB139+140" = 0.0006374,
    PCB141 = 0.0074487,
    PCB142 = 0.0000684,
    PCB144 = 0.0029722,
    PCB145 = 0.0000448,
    PCB146 = 0.0047038,
    PCB147 = 0.0380428,
    "PCB148+149" = 0.0000688,
    PCB150 = 0.0000961,
    PCB152 = 0.0000942,
    "PCB153+168" = 0.0297369,
    PCB155 = 0.0000547,
    "PCB156+157" = 0.0023521,
    PCB158 = 0.0033555,
    PCB159 = 0.0001636,
    PCB161 = 0.0000729,
    PCB162 = 0.0000765,
    PCB164 = 0.0020785,
    PCB165 = 0.0000076,
    PCB167 = 0.0008628,
    PCB169 = 0.0003088,
    PCB170 = 0.0040513,
    PCB171 = 0.0025659,
    "PCB172+173" = 0.0011277,
    PCB174 = 0.0092613,
    PCB175 = 0.0005267,
    PCB176 = 0.0018508,
    PCB177 = 0.004492,
    PCB178 = 0.0022437,
    PCB179 = 0.0062762,
    PCB180 = 0.012314,
    "PCB181+193" = 0.0001953,
    PCB182 = 0.0004382,
    PCB183 = 0.0072779,
    "PCB184+185" = 0.000318,
    PCB186 = 0.0000554,
    PCB187 = 0.0131026,
    PCB188 = 0.0002588,
    PCB189 = 0.0005153,
    PCB190 = 0.0008665,
    PCB191 = 0.0002282,
    PCB192 = 0.0000386,
    PCB194 = 0.001596,
    PCB195 = 0.0006441,
    PCB196 = 0.001192,
    "PCB197+200" = 0.0012473,
    "PCB198+199" = 0.0029903,
    PCB201 = 0.0005456,
    PCB202 = 0.00126,
    PCB203 = 0.0018125,
    PCB204 = 0,
    PCB205 = 0.000145,
    PCB206 = 0.0007922,
    PCB207 = 0.0002053,
    PCB208 = 0.0003838,
    PCB209 = 0.0006354
  )

# Aroclor profiles
prof.aroclor <- data.frame(
  Aroclor = c("1221 A1", "1232 A1.5", "1232 G1.5", "1016 A2", "1016 S2", 
              "1242 A3", "1242 G3", "1242 S3B", "1248 A3.5", "1248 G3.5",
              "1254 A4", "1254 G4", "1260 A5", "1260 S5", "1260 G5",
              "1262 A6", "1262 G6"),
  PCB1 = c(35.8, 15.21, 15.84, 0.518, 0.54, 0.51, 0.34, 0.78, 0.0537, 0.0189, 0.0165, 0, 0.03, 0.03, 0.01, 0.02, 0.03),
  PCB2 = c(3.81, 1.98, 1.94, 0.0243, 0.03, 0.02, 0.02, 0.05, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB3 = c(20.44, 10.36, 10.2, 0.154, 0.16, 0.15, 0.11, 0.27, 0.0129, 0, 0, 0, 0, 0, 0, 0, 0.01),
  PCB4 = c(6.19, 5.32, 5.38, 3.616, 3.66, 3.11, 2.71, 3.41, 0.3193, 0.0415, 0.0183, 0.0579, 0.03, 0.03, 0, 0.07, 0.04),
  PCB5 = c(0.74, 0.49, 0.5, 0.1663, 0.15, 0.13, 0.11, 0.19, 0.0045, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB6 = c(3.82, 3.02, 3, 1.6448, 1.69, 1.42, 1.24, 1.63, 0.1265, 0.0047, 0, 0.0203, 0.01, 0.01, 0, 0.03, 0.02),
  PCB7 = c(1.7, 1.12, 1.09, 0.2933, 0.3, 0.26, 0.18, 0.34, 0.0172, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB8 = c(12.34, 10.71, 10.72, 8.29, 8.31, 6.99, 6.48, 7.68, 0.8134, 0.2552, 0.0531, 0.1332, 0.06, 0.06, 0, 0.15, 0.08),
  PCB9 = c(1.74, 1.25, 1.29, 0.5806, 0.59, 0.5, 0.4, 0.6, 0.0396, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB10 = c(0.8, 0.6, 0.58, 0.233, 0.23, 0.2, 0.14, 0.25, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB11 = c(0.16, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB12+13` = c(1.71, 1.08, 1.07, 0.3074, 0.32, 0.26, 0.21, 0.36, 0.0173, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB14 = c(0, 0, 0.02, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB15 = c(4.18, 3.24, 3.19, 2.4014, 2.49, 1.98, 1.95, 2.39, 0.2156, 0.0626, 0.0125, 0.028, 0, 0.02, 0, 0.03, 0.02),
  PCB16 = c(0.31, 1.79, 1.79, 3.8765, 3.88, 3.03, 3.44, 2.94, 1.039, 0.7112, 0.0183, 0.0888, 0.02, 0.02, 0, 0.07, 0.03),
  PCB17 = c(0.34, 1.83, 1.82, 3.9752, 3.98, 3.14, 3.29, 2.97, 1.0547, 0.9334, 0.0203, 0.085, 0.02, 0.02, 0, 0.07, 0.03),
  `PCB18+30` = c(0.78, 4.89, 4.83, 10.8574, 10.75, 8.53, 9.14, 7.93, 4.2939, 3.2932, 0.082, 0.2533, 0.07, 0.07, 0, 0.19, 0.1),
  PCB19 = c(0.08, 0.46, 0.47, 0.9932, 1.01, 0.79, 0.84, 0.75, 0.2172, 0.1367, 0, 0, 0, 0, 0, 0.02, 0),
  `PCB20+28` = c(0.69, 4.34, 4.31, 9.3806, 9.46, 7.36, 8.08, 7.31, 3.7321, 5.6458, 0.0597, 0.1937, 0.05, 0.05, 0, 0.15, 0.08),
  `PCB21+33` = c(0.48, 2.84, 2.88, 6.213, 6.19, 4.85, 5.35, 4.82, 2.228, 2.213, 0.0501, 0.1625, 0.04, 0.04, 0, 0.13, 0.07),
  PCB22 = c(0.26, 1.62, 1.62, 3.5019, 3.51, 2.71, 3.08, 2.73, 1.3291, 1.3769, 0.0221, 0.0382, 0.02, 0.02, 0, 0.06, 0.03),
  PCB23 = c(0, 0, 0, 0.0135, 0.02, 0.01, 0.01, 0.01, 0, 0.0042, 0, 0, 0, 0, 0, 0, 0),
  PCB24 = c(0.02, 0.08, 0.08, 0.1623, 0.17, 0.13, 0.13, 0.14, 0.009, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB25 = c(0.09, 0.37, 0.37, 0.7193, 0.72, 0.57, 0.61, 0.6, 0.1063, 0.0424, 0, 0.0345, 0, 0, 0, 0.03, 0.01),
  `PCB26+29` = c(0.14, 0.8, 0.79, 1.6733, 1.69, 1.29, 1.46, 1.33, 0.4007, 0.24, 0, 0, 0, 0, 0, 0.03, 0.01),
  PCB27 = c(0.05, 0.12, 0.12, 0.507, 0, 0.4, 0.44, 0.39, 0.1216, 0.069, 0, 0, 0, 0, 0, 0, 0),
  PCB31 = c(0.6, 4.17, 4.11, 9.3151, 9.26, 7.18, 7.82, 7.01, 5.0692, 5.4684, 0.1109, 0.282, 0.06, 0.05, 0, 0.16, 0.08),
  PCB32 = c(0.17, 1.08, 1.07, 2.374, 2.37, 1.85, 2.05, 1.79, 0.876, 0.9273, 0.0146, 0.055, 0.01, 0.01, 0, 0.05, 0.02),
  PCB34 = c(0, 0.01, 0.01, 0.0305, 0.03, 0.02, 0.02, 0.03, 0.0044, 0.0028, 0, 0, 0, 0, 0, 0, 0),
  PCB35 = c(0, 0.06, 0.05, 0.0542, 0.06, 0.07, 0.07, 0.09, 0.0033, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB36 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB37 = c(0.19, 1.15, 1.12, 1.019, 1.01, 1.86, 2.19, 2.05, 0.7877, 0.9542, 0.0135, 0.0699, 0.01, 0, 0, 0.04, 0.02),
  PCB38 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  PCB39 = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB40+41+71` = c(0.13, 1.3, 1.25, 2.4995, 2.51, 2.5, 2.54, 2.37, 3.5742, 3.542, 0.2831, 0.2863, 0, 0, 0, 0.02, 0),
  PCB42 = c(0.09, 0.66, 0.69, 1.5886, 1.59, 1.13, 1.25, 1.17, 1.6689, 1.7861, 0.0931, 0.1479, 0, 0, 0, 0.03, 0.01),
  `PCB43+73` = c(0, 0.12, 0.09, 0.2843, 0.25, 0.18, 0.19, 0.16, 0.2983, 0.1881, 0, 0, 0, 0, 0, 0, 0),
  `PCB44+47+65` = c(0.26, 2.3, 2.3, 5.7257, 5.72, 4.57, 4.55, 4.33, 7.8009, 7.5043, 0.7371, 2.4559, 0.04, 0.04, 0.03, 0.11, 0.05),
  `PCB45+51` = c(0.04, 0.59, 0.58, 1.5433, 1.54, 1.18, 1.14, 1.06, 1.3974, 1.2203, 0.0223, 0.049, 0, 0, 0, 0, 0),
  PCB46 = c(0.02, 0.19, 0.19, 0.4855, 0.48, 0.37, 0.38, 0.33, 0.471, 0.3932, 0, 0, 0, 0, 0, 0.01, 0),
  PCB48 = c(0.06, 0.61, 0.62, 1.6105, 1.59, 1.18, 1.17, 1.19, 1.6643, 1.5412, 0.0534, 0.1198, 0, 0, 0, 0.01, 0),
  PCB49 = c(0.15, 1.37, 1.36, 3.3522, 3.4, 2.59, 2.6, 2.38, 4.1166, 4.1742, 0.265, 1.0958, 0.01, 0.02, 0.01, 0.07, 0.04),
  `PCB50+53` = c(0.04, 0.37, 0.37, 0.9658, 0.95, 0.75, 0.71, 0.68, 1.0506, 0.8778, 0.0432, 0.117, 0, 0, 0, 0, 0),
  `PCB52` = c(0.22, 1.83, 1.86, 4.6335, 4.61, 3.64, 3.47, 3.47, 6.9299, 5.5779, 0.8252, 5.3793, 0.27, 0.25, 0.21, 0.17, 0.11),
  `PCB54` = c(0, 0, 0, 0.0103, 0.02, 0, 0, 0.01, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB55` = c(0, 0.05, 0.05, 0, 0, 0.09, 0.11, 0.1, 0.0592, 0.0501, 0, 0, 0, 0, 0, 0, 0),
  `PCB56` = c(0.12, 0.93, 0.92, 0.0726, 0.06, 1.8, 1.85, 1.8, 3.1607, 3.1916, 1.6955, 0.5488, 0.02, 0.02, 0, 0.04, 0.02),
  `PCB57` = c(0, 0, 0.01, 0.0101, 0.01, 0.02, 0, 0.03, 0.023, 0.0227, 0, 0, 0, 0, 0, 0, 0),
  `PCB58` = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB59+62+75` = c(0.01, 0.22, 0.17, 0.4718, 0.44, 0.42, 0.35, 0.31, 0.4494, 0.3129, 0.0067, 0.0232, 0, 0, 0, 0, 0),
  `PCB60` = c(0.07, 0.61, 0.6, 0.041, 0.03, 1.17, 1.17, 1.19, 1.8523, 2.6728, 0.9496, 0.1796, 0.04, 0.04, 0.03, 0.02, 0.02),
  `PCB61+70+74+76` = c(0.36, 2.82, 2.82, 0.9191, 0.89, 5.67, 5.54, 5.66, 10.5543, 12.1948, 9.0442, 4.345, 0.09, 0.09, 0.09, 0.18, 0.11),
  `PCB63` = c(0, 0.1, 0.1, 0.0553, 0.05, 0.13, 0.11, 0.12, 0.17, 0.19, 0.07, 0.02, 0, 0, 0, 0, 0),
  `PCB64` = c(0.1, 0.87, 0.87, 1.8703, 1.84, 1.76, 1.68, 1.67, 3.0094, 3.3216, 0.3639, 0.5873, 0.01, 0.01, 0, 0.04, 0.02),
  `PCB66` = c(0.21, 1.74, 1.71, 0.3884, 0.36, 3.38, 3.38, 3.4, 5.8359, 7.2154, 3.5596, 1.0069, 0.03, 0.03, 0.01, 0.08, 0.05),
  `PCB67` = c(0, 0.09, 0.08, 0.0576, 0.06, 0.15, 0.17, 0.16, 0.1252, 0.0989, 0.007, 0, 0, 0, 0, 0, 0),
  `PCB68` = c(0, 0, 0, 0.0042, 0, 0, 0, 0.01, 0.0176, 0.0131, 0, 0, 0, 0, 0, 0, 0),
  `PCB72` = c(0, 0, 0, 0, 0, 0, 0, 0, 0.4117, 0.5204, 0.2017, 0.0283, 0, 0, 0, 0, 0),
  `PCB77` = c(0.01, 0.17, 0.16, 0, 0, 0.01, 0.01, 0.01, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB78` = c(0, 0, 0, 0, 0, 0, 0, 0, 0.0142, 0.02, 0.0029, 0, 0, 0, 0, 0, 0),
  `PCB79` = c(0, 0, 0, 0, 0, 0, 0, 0, 0.8139, 0.6223, 1.5269, 1.1061, 0.03, 0.04, 0.06, 0.06, 0.03),
  `PCB80` = c(0, 0, 0, 0, 0, 0, 0, 0, 1.7299, 2.0133, 5.09, 3.5034, 0.11, 0.12, 0.1, 0.05, 0.03),
  `PCB81` = c(0, 0, 0, 0, 0, 0, 0, 0, 1.262, 0.914, 1.577, 2.3207, 0, 0, 0.02, 0.03, 0.01),
  `PCB82` = c(0, 0, 0, 0, 0, 0, 0, 0, 1.0761, 1.2344, 2.6832, 1.5082, 0.54, 0.51, 0.44, 0.17, 0.14),
  `PCB83+99` = c(0.04, 0.12, 0.12, 0, 0, 0.29, 0.22, 0.28, 3.0596, 2.3977, 7.2224, 7.1459, 3.23, 3.18, 2.99, 1.03, 1.23),
  `PCB84` = c(0.02, 0.26, 0.25, 0.0133, 0.01, 0.65, 0.45, 0.61, 0.649, 0.5799, 0.5275, 0.9277, 0.34, 0.32, 0.25, 0.07, 0.09),
  `PCB85+116+117` = c(0.03, 0.2, 0.18, 0.05, 0.05, 0.46, 0.35, 0.43, 0.2, 0.17, 0.11, 0.09, 0, 0.04, 0.01, 0, 0),
  `PCB86+87+97+109+119+125` = c(0.07, 0.18, 0.17, 0, 0, 0.39, 0.26, 0.36, 2.2185, 1.8871, 5.5062, 8.0243, 5.79, 5.72, 5.26, 1.9, 2.22),
  `PCB88+91` = c(0.1, 0.05, 0.05, 0, 0, 0.1, 0.1, 0.09, 0.3795, 0.2481, 0.5747, 1.2933, 0, 0, 0, 0, 0),
  `PCB89` = c(0, 0, 0, 0.0384, 0.03, 0.06, 0.09, 0.13, 4.41, 3.52, 7.425, 14.431, 0, 0, 0, 0, 0),
  `PCB90+101+113` = c(0, 0.01, 0.01, 0, 0, 0, 0, 0, 0.0316, 0.0217, 0, 0.024, 0, 0, 0, 0, 0),
  `PCB92` = c(0.05, 0.33, 0.32, 0.0628, 0.06, 0.78, 0.57, 0.71, 0.0764, 0.0593, 0.0119, 0.0445, 0, 0, 0, 0, 0),
  `PCB93+95+98+100+102` = c(0, 0, 0, 0, 0, 0, 0, 0, 0.0174, 0.0073, 0, 0.0251, 0, 0, 0, 0, 0),
  `PCB94` = c(0, 0, 0, 0, 0, 0.52, 0.37, 0.52, 1.5992, 1.4546, 7.3704, 2.9937, 0.22, 0.21, 0.23, 0.18, 0),
  `PCB96` = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB103` = c(0, 0, 0, 0.0011, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB104` = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB105` = c(0, 0, 0, 0, 0, 0, 0, 0, 0.0985, 0.0672, 0.4669, 0.2874, 0, 0, 0, 0, 0),
  `PCB106` = c(0, 0, 0, 0, 0, 0, 0, 0, 3.0852, 2.6662, 8.7927, 9.4889, 1.38, 1.36, 1.25, 0.36, 0.42),
  `PCB107` = c(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB108+124` = c(0, 0, 0, 0, 0, 0.03, 0.02, 0.03, 0.1193, 0.118, 0.504, 0.1825, 0, 0, 0, 0, 0),
  `PCB110+115` = c(6.025, 5.382506853, 3.825, 0.2725, 0.254173935, 0.20175, 0.106653377, 0.0785, 2.2885, 2.3461, 13.5902, 7.3533, 0.51, 0.5, 0.45, 0.17, 0.14),
  `PCB111` = c(0.00945, 0.010690257, 0.014625, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB112` = c(0.00915, 0.006279591, 0.0139, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB114` = c(0.05375, 0.050834787, 0.04075, 0, 0, 0, 0, 0, 0.0491, 0, 0.2512, 0.0966, 0, 0, 0, 0, 0),
  `PCB118` = c(2.625, 2.317468228, 1.745, 0, 0, 0, 0, 0, 0.0635, 0.0491, 0, 0, 0, 0, 0, 0, 0),
  `PCB120` = c(0.022625, 0.030650386, 0.013775, 0, 0, 0, 0, 0, 0.07, 0.08, 0.32, 0.15, 0, 0, 0, 0, 0),
  `PCB121` = c(0.011825, 0.012285074, 0.0148, 0, 0, 0, 0, 0, 0.0037, 0.0029, 0.0158, 0.0017, 0, 0, 0, 0, 0),
  `PCB122` = c(0.04075, 0.034139048, 0.032, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB123` = c(0.05525, 0.043608273, 0.0305, 0, 0, 0, 0, 0, 0.56, 0.55, 0.5, 0, 0, 0, 0, 0, 0),
  `PCB126` = c(0.01605, 0.00884625, 0.0172, 0, 0, 0, 0, 0, 9.03, 8.98, 9.29, 0, 0, 0, 0, 0, 0),
  `PCB127` = c(0.014975, 0.008298031, 0.01665, 0, 0, 0, 0, 0, 0.23, 0.22, 0.21, 0, 0, 0, 0, 0, 0),
  `PCB128+166` = c(0.4325, 0.401196113, 0.2525, 0, 0, 0, 0, 0, 0.08, 0.07, 0.05, 0, 0, 0, 0, 0, 0),
  `PCB129+138+160+163` = c(3.3, 3.563418889, 2.2275, 0, 0, 0, 0, 0, 2.84, 2.96, 0, 0, 0, 0, 0, 0, 0),
  `PCB130` = c(0.21375, 0.194119113, 0.126, 0, 0, 0, 0, 0, 1.48, 1.45, 0, 0, 0, 0, 0, 0, 0),
  `PCB131` = c(0.04875, 0.031896337, 0.0275, 0, 0, 0, 0, 0, 0.02, 0.02, 0, 0, 0, 0, 0, 0, 0),
  `PCB132` = c(1.41, 1.360578121, 0.9475, 0, 0, 0, 0, 0, 2.62, 2.68, 0, 0, 0, 0, 0, 0, 0),
  `PCB133` = c(0.085, 0.096187391, 0.0645, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB134+143` = c(0.265, 0.247694991, 0.1675, 0, 0, 0, 0, 0, 0.61, 0.61, 0, 0, 0, 0, 0, 0, 0),
  `PCB135+151+154` = c(1.905, 2.108148517, 1.38, 0, 0, 0, 0, 0, 1.17, 1.15, 0, 0, 0, 0, 0, 0, 0),
  `PCB136` = c(0.7525, 0.824819337, 0.565, 0, 0, 0, 0, 0, 8.74, 8.78, 8.73, 0, 0, 0, 0, 0, 0),
  `PCB137` = c(0.09875, 0.086967356, 0.06925, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB139+140` = c(0.07775, 0.073760279, 0.0405, 0, 0, 0, 0, 0, 9.09, 9.17, 9.91, 0, 0, 0, 0, 0, 0),
  `PCB141` = c(0.6275, 0.613007725, 0.46, 0, 0, 0, 0, 0, 0.55, 0.56, 0.52, 0, 0, 0, 0, 0, 0),
  `PCB142` = c(0.015975, 0.012733616, 0.010625, 0, 0, 0, 0, 0, 0.57, 0.58, 0.6, 0, 0, 0, 0, 0, 0),
  `PCB144` = c(0.1915, 0.217542985, 0.144, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB145` = c(0.002155, 0.0021231, 0.0022475, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB146` = c(0.665, 0.740094692, 0.4475, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB147+149` = c(4.3, 4.410665338, 2.9, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB148` = c(0.021125, 0.025417393, 0.01655, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB150` = c(0.028, 0.030401196, 0.019775, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB152` = c(0.0116, 0.016247197, 0.01295, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB153+168` = c(3, 3.065038624, 2.0375, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB155` = c(0.003875, 0.005457264, 0.004875, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB156+157` = c(0.2115, 0.189633691, 0.12625, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB158` = c(0.265, 0.261649639, 0.173, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB159` = c(0.02775, 0.027909295, 0.0073, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB161` = c(0.0114, 0.008945926, 0.007575, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB162` = c(0.01005, 0.008123598, 0.006675, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB164` = c(0.25, 0.243458759, 0.16225, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB165` = c(0.01255, 0.010117119, 0.00835, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB167` = c(0.082, 0.070520807, 0.05175, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB169` = c(0.012, 0.010191876, 0.007975, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB170` = c(0.2875, 0.346374284, 0.211, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB171+173` = c(0.136, 0.134562671, 0.08425, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB172` = c(0.07225, 0.074507849, 0.05025, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB174` = c(0.4975, 0.493396462, 0.315, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB175` = c(0.02035, 0.020333915, 0.012325, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB176` = c(0.07275, 0.07600299, 0.0465, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB177` = c(0.227, 0.20782457, 0.14725, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB178` = c(0.12975, 0.135061052, 0.094, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB179` = c(0.2825, 0.331422876, 0.204, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB180+193` = c(0.9125, 1.039122851, 0.6425, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB181` = c(0.007325, 0.007874408, 0.0033, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB182` = c(0.00475, 0.002616496, 0.0021375, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB183+185` = c(0.32, 0.363817593, 0.2195, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB184` = c(0.002155, 0.002741091, 0.0022875, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB186` = c(0.002155, 0.0021231, 0.0021375, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB187` = c(0.76, 0.779965113, 0.38, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB188` = c(0.002155, 0.0021231, 0.003, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB189` = c(0.010075, 0.011487665, 0.00685, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB190` = c(0.0745, 0.068527286, 0.04425, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB191` = c(0.01485, 0.014353352, 0.006825, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB192` = c(0.002155, 0.002434588, 0.0021375, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB194` = c(0.12575, 0.108646898, 0.07825, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB195` = c(0.0495, 0.058808871, 0.03, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB196` = c(0.08575, 0.066782955, 0.04675, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB197+200` = c(0.0255, 0.029653626, 0.01855, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB198+199` = c(0.2395, 0.178170944, 0.12675, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB201` = c(0.02925, 0.024570147, 0.012625, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB202` = c(0.04975, 0.047595315, 0.033, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB203` = c(0.159, 0.105656616, 0.084, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB204` = c(0.002155, 0.0021231, 0.0021375, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB205` = c(0.004875, 0.006952405, 0.004425, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB206` = c(0.13575, 0.064789434, 0.055, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB207` = c(0.024475, 0.01440319, 0.0113, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB208` = c(0.059, 0.027909295, 0.017125, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  `PCB209` = c(0.04725, 0.045850984, 0.02575, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  stringsAsFactors = FALSE,
  check.names = FALSE
)

# Need to combine PCB congeners to have the same list over all the profiles
prof.air$`PCB40+41+71` <- prof.air$`PCB40+71` + prof.air$`PCB41`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB40+71", "PCB41"))]

prof.air$`PCB43+73` <- prof.air$`PCB43` + prof.air$`PCB73`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB43", "PCB73"))]

prof.air$`PCB45+51` <- prof.air$`PCB45` + prof.air$`PCB51`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB45", "PCB51"))]

prof.air$`PCB83+99` <- prof.air$`PCB83` + prof.air$`PCB99`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB83", "PCB99"))]

prof.air$`PCB85+116+117` <- prof.air$`PCB85+116` + prof.air$`PCB117`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB85+116", "PCB117"))]

prof.air$`PCB86+87+97+109+119+125` <- prof.air$`PCB86+97+109+119` + prof.air$`PCB87+125`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB86+97+109+119", "PCB87+125"))]

prof.air$`PCB88+91` <- prof.air$`PCB88` + prof.air$`PCB91`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB88", "PCB91"))]

prof.air$`PCB93+95+98+100+102` <- prof.air$`PCB93+100` + prof.air$`PCB95` +
  prof.air$`PCB98` + prof.air$`PCB102`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB93+100", "PCB95", "PCB98", "PCB102"))]

prof.air$`PCB110+115` <- prof.air$`PCB110` + prof.air$`PCB115`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB110", "PCB115"))]

prof.air$`PCB129+138+160+163` <- prof.air$`PCB129+138+163` + prof.air$`PCB160` # 160 missing
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB129+138+163", "PCB160"))]

prof.air$`PCB134+143` <- prof.air$`PCB134` + prof.air$`PCB143`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB134", "PCB143"))]

prof.air$`PCB135+151+154` <- prof.air$`PCB135+151` + prof.air$`PCB154`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB135+151", "PCB154"))]

prof.air$`PCB183+185` <- prof.air$`PCB183` + prof.air$`PCB185`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB183", "PCB185"))]

prof.air$`PCB197+200` <- prof.air$`PCB197` + prof.air$`PCB200`
# Remove the original columns
prof.air <- prof.air[, !(names(prof.air) %in% c("PCB197", "PCB200"))]

# water and flux
# Create the new combined row
combined_row <- data.frame(
  congener = "PCB43+73",
  mean = sum(prof.water$mean[prof.water$congener %in% c("PCB43", "PCB73")]),
  sd = sum(prof.water$sd[prof.water$congener %in% c("PCB43", "PCB73")])
)

# Remove the original rows
prof.water <- prof.water[!(prof.water$congener %in% c("PCB43", "PCB73")), ]

# Append the new combined row
prof.water <- rbind(prof.water, combined_row)





# prof.air: get column names starting with "PCB"
air_congeners <- grep("^PCB", names(prof.air), value = TRUE)

# prof.aroclor: same idea
aroclor_congeners <- grep("^PCB", names(prof.aroclor), value = TRUE)

# prof.flux: get from Congener column
flux_congeners <- grep("^PCB", names(prof.flux), value = TRUE)

# prof.water: get from congener column
water_congeners <- grep("^PCB", names(prof.water), value = TRUE)



# prof.sed: extract names attribute
sed_congeners <- names(prof.sed)






# Format data
air_profile <- prof.air[, grep("^PCB", names(prof.air))]
air_profile$source <- "air"

aroclor_profile <- prof.aroclor[, grep("^PCB", names(prof.aroclor))]
aroclor_profile$source <- "aroclor"

water_profile <- prof.water %>%
  select(congener, mean) %>%
  pivot_wider(names_from = congener, values_from = mean) %>%
  mutate(source = "water")

flux_profile <- prof.flux %>%
  select(Congener, `Mean (ng/m2/d)`) %>%
  rename(mean = `Mean (ng/m2/d)`) %>%
  pivot_wider(names_from = Congener, values_from = mean) %>%
  mutate(source = "flux")
# Need to change + to .
names(flux_profile) <- gsub("\\+", ".", names(flux_profile))

# Get column names (excluding the "source" column)
water_pcbs <- setdiff(names(water_profile), "source")
flux_pcbs  <- setdiff(names(flux_profile), "source")

# Check if they are the same
setequal(water_pcbs, flux_pcbs) # True

air_pcbs     <- setdiff(names(air_profile), "source")
aroclor_pcbs <- setdiff(names(aroclor_profile), "source")

# Check if they are the same
setequal(air_pcbs, aroclor_pcbs) # True

extra_pcbs <- setdiff(air_pcbs, flux_pcbs)





# Format air and aroclors data
# Removing metadata
prof.air.1 <- prof.air[,-c(1, 2)]
prof.aroclor.1 <- prof.aroclor[,-1]

# Format water and flux data
prof.water.1 <- as.data.frame(prof.water[, c(2, 3)])
prof.flux.1 <- as.data.frame(prof.flux[, c(2, 3)])

# Need to transform values to fraction in the flux
prof.flux.2 <- prof.flux.1[, -1]  # Remove metadata
tmp <- sum(prof.flux.2, na.rm = TRUE)
prof <- sweep(prof.flux.2, 1, tmp, FUN = "/")
prof.ave <- data.frame(colMeans(prof, na.rm = TRUE))
colnames(prof.ave) <- c("mean")



prof.water.flux <- cbind(prof.water.1, prof.flux.1$`Mean (ng/m2/d)`)


# Combine both profiles
prof <- rbind(prof.air.1, prof.aroclor.1)
# Change format to numeric
prof[] <- lapply(prof, function(x) as.numeric(as.character(x)))

# Calcualte cosine Theta
CosineTheta <- as.data.frame(cosine(t(prof)))

# Add metadata
siteName <- prof.air[, 2]
siteName <- as.data.frame(siteName)
colnames(siteName) <- 'name'
AroclorName <- prof.aroclor[, 1]
AroclorName <- as.data.frame(AroclorName)
colnames(AroclorName) <- 'name'
id <- rbind(siteName, AroclorName)
colnames(CosineTheta) <- t(id)
CosineTheta <- cbind(id, CosineTheta)
# Remove values on the upper diagonal (duplicates)
CosineTheta[upper.tri(CosineTheta, diag = FALSE)] <- NA

# Save results
write.csv(CosineTheta, "Output/Data/csv/CosineThetaResults.csv")  


