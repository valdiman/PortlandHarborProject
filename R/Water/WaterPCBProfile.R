# Water PCB profile Plot. Figure 3 (B) from paper

# Packages and libraries needed --------------------------------------------
# Install packages
install.packages("ggplot2")

# Libraries
library(ggplot2)

# Water concentrations ----------------------------------------------------
# Average of the three highest samples
# This approach was used in the paper to estimate emissions
# and used in AERMOD
# WCPCB_OR-POH003 8/22/18, WCPCB_OR-POH004 8/23/18 &
# WCPCB_OR-POH005 8/21/18
wc <- data.frame(
  SampleID = c("WCPCB_OR-POH003-20180822.1", "WCPCB_OR-POH004-20180823.1", "WCPCB_OR-POH005-20180821.1"),
  LocationName = c("Willamette River at Kingsley Community Garden", 
                   "Willamette River at south Burlington Northern Railroad Bridge 5.1",
                   "Willamette River at NW Front Ave"),
  LocationID = c("WCPCB_OR-POH003", "WCPCB_OR-POH004", "WCPCB_OR-POH005"),
  SampleDate = c("8/22/2018", "8/23/2018", "8/21/2018"),
  Latitude = c(45.6068885, 45.5759428, 45.5583833),
  Longitude = c(-122.7841601, -122.7451604, -122.7186394),
  Units = rep("pg/L", 3),
  PCB1 = c(1.1425, 1.201096437, 1.565),
  PCB2 = c(0.2115, 0.184649888, 0.17325),
  PCB3 = c(0.385, 0.378769001, 0.5375),
  PCB4 = c(15.85, 15.62422128, 35.5),
  PCB5 = c(0.11675, 0.097931722, 0.07375),
  PCB6 = c(1.145, 0.862197857, 1.4525),
  PCB7 = c(0.4375, 0.33889858, 0.6125),
  PCB8 = c(4.975, 3.688013955, 6.175),
  PCB9 = c(0.3375, 0.266633441, 0.28),
  PCB10 = c(0.9175, 0.88711687, 1.415),
  PCB11 = c(11.5, 8.721654622, 7.45),
  `PCB12+13` = c(0.3425, 0.279092948, 0.4725),
  PCB14 = c(0.033, 0.026663344, 0.02725),
  PCB15 = c(1.965, 1.305756292, 2.045),
  PCB16 = c(2.8, 2.24520309, 3.025),
  PCB17 = c(6.45, 6.279591328, 8.525),
  `PCB18+30` = c(6.55, 5.606777972, 7.325),
  PCB19 = c(13.425, 15.12584102, 27),
  `PCB20+28` = c(7.375, 4.535260404, 5.925),
  `PCB21+33` = c(7.225, 5.35758784, 7.225),
  PCB22 = c(2.4925, 1.612260154, 1.99),
  PCB23 = c(0.0295, 0.01741839, 0.02575),
  PCB24 = c(0.1125, 0.090456018, 0.1145),
  PCB25 = c(2.3375, 2.105656616, 1.91),
  `PCB26+29` = c(1.3475, 1.001744331, 1.4775),
  PCB27 = c(0.9525, 1.123847496, 1.6325),
  PCB31 = c(5.575, 3.613256915, 4.925),
  PCB32 = c(2.3575, 2.432095689, 3.95),
  PCB34 = c(0.0585, 0.05681535, 0.045),
  PCB35 = c(0.11425, 0.05731373, 0.07625),
  PCB36 = c(0.03825, 0.015325193, 0.0475),
  PCB37 = c(1.1475, 0.682780962, 0.8725),
  PCB38 = c(0.02775, 0.01642163, 0.024225),
  PCB39 = c(0.065, 0.070769998, 0.05525),
  `PCB40+41+71` = c(3.825, 2.840767506, 2.49),
  PCB42 = c(1.7575, 1.308248193, 1.0775),
  PCB43 = c(0.3275, 0.17069524, 0.141),
  `PCB44+47+65` = c(28.5, 24.09668577, 26.25),
  `PCB45+51` = c(97, 79.74084226, 104.75),
  PCB46 = c(0.945, 0.742586594, 0.8425),
  PCB48 = c(1.1475, 0.787440817, 0.7575),
  `PCB49+69` = c(5.9, 5.108397707, 4.45),
  `PCB50+53` = c(2.95, 3.139795664, 3.275),
  PCB52 = c(9.675, 8.347869424, 7.375),
  PCB54 = c(1.27, 1.497632694, 1.715),
  PCB55 = c(0.014275, 0.020358834, 0.063),
  PCB56 = c(1.685, 1.402940444, 1.0575),
  PCB57 = c(0.03425, 0.018714179, 0.0117),
  PCB58 = c(0.02575, 0.02172938, 0.01225),
  `PCB59+62+75` = c(0.68, 0.515823573, 0.4525),
  PCB60 = c(0.7675, 0.66035385, 0.475),
  `PCB61+70+74+76` = c(6.375, 4.958883628, 4.15),
  PCB63 = c(0.17325, 0.141789185, 0.09825),
  PCB64 = c(2.65, 2.005980563, 1.5975),
  PCB66 = c(3.85, 3.139795664, 2.2875),
  PCB67 = c(0.0895, 0.060553202, 0.063),
  PCB68 = c(16.375, 9.269872913, 9.075),
  PCB72 = c(0.111, 0.108896088, 0.0555),
  PCB73 = c(0.193, 0.156740593, 0.15875),
  PCB77 = c(0.2295, 0.216546225, 0.1375),
  PCB78 = c(0.014075, 0.020059806, 0.012525),
  PCB79 = c(0.0115, 0.125841017, 0.010225),
  PCB80 = c(0.01285, 0.018290556, 0.011425),
  PCB81 = c(0.02095, 0.015574383, 0.01),
  PCB82 = c(0.58, 0.503364067, 0.32),
  `PCB83+99` = c(3.3, 3.040119611, 2.005),
  PCB84 = c(1.84, 1.749314727, 1.1525),
  `PCB85+116+117` = c(0.835, 0.784948916, 0.5175),
  `PCB86+87+97+109+119+125` = c(3.6, 3.314228757, 2.1925),
  `PCB88+91` = c(1.3375, 1.345626713, 0.875),
  PCB89 = c(0.0785, 0.068776476, 0.04575),
  `PCB90+101+113` = c(5.925, 5.681535011, 3.725),
  PCB92 = c(1.305, 1.255918266, 0.7575),
  `PCB93+95+98+100+102` = c(7.525, 7.201594817, 4.85),
  PCB94 = c(0.12475, 0.154497882, 0.08375),
  PCB96 = c(0.1395, 0.159730875, 0.1055),
  PCB103 = c(0.236, 0.269125343, 0.1695),
  PCB104 = c(0.05125, 0.057562921, 0.0425),
  PCB105 = c(0.97, 0.844754548, 0.6225),
  PCB106 = c(0.01335, 0.007376028, 0.016375),
  PCB107 = c(0.2725, 0.254173935, 0.20175),
  `PCB108+124` = c(0.1335, 0.106653377, 0.0785),
  `PCB110+115` = c(6.025, 5.382506853, 3.825),
  PCB111 = c(0.00945, 0.010690257, 0.014625),
  PCB112 = c(0.00915, 0.006279591, 0.0139),
  PCB114 = c(0.05375, 0.050834787, 0.04075),
  PCB118 = c(2.625, 2.317468228, 1.745),
  PCB120 = c(0.022625, 0.030650386, 0.013775),
  PCB121 = c(0.011825, 0.012285074, 0.0148),
  PCB122 = c(0.04075, 0.034139048, 0.032),
  PCB123 = c(0.05525, 0.043608273, 0.0305),
  PCB126 = c(0.01605, 0.00884625, 0.0172),
  PCB127 = c(0.014975, 0.008298031, 0.01665),
  `PCB128+166` = c(0.4325, 0.401196113, 0.2525),
  `PCB129+138+160+163` = c(3.3, 3.563418889, 2.2275),
  PCB130 = c(0.21375, 0.194119113, 0.126),
  PCB131 = c(0.04875, 0.031896337, 0.0275),
  PCB132 = c(1.41, 1.360578121, 0.9475),
  PCB133 = c(0.085, 0.096187391, 0.0645),
  `PCB134+143` = c(0.265, 0.247694991, 0.1675),
  `PCB135+151+154` = c(1.905, 2.108148517, 1.38),
  PCB136 = c(0.7525, 0.824819337, 0.565),
  PCB137 = c(0.09875, 0.086967356, 0.06925),
  `PCB139+140` = c(0.07775, 0.073760279, 0.0405),
  PCB141 = c(0.6275, 0.613007725, 0.46),
  PCB142 = c(0.015975, 0.012733616, 0.010625),
  PCB144 = c(0.1915, 0.217542985, 0.144),
  PCB145 = c(0.002155, 0.0021231, 0.0022475),
  PCB146 = c(0.665, 0.740094692, 0.4475),
  `PCB147+149` = c(4.3, 4.410665338, 2.9),
  PCB148 = c(0.021125, 0.025417393, 0.01655),
  PCB150 = c(0.028, 0.030401196, 0.019775),
  PCB152 = c(0.0116, 0.016247197, 0.01295),
  `PCB153+168` = c(3, 3.065038624, 2.0375),
  PCB155 = c(0.003875, 0.005457264, 0.004875),
  `PCB156+157` = c(0.2115, 0.189633691, 0.12625),
  PCB158 = c(0.265, 0.261649639, 0.173),
  PCB159 = c(0.02775, 0.027909295, 0.0073),
  PCB161 = c(0.0114, 0.008945926, 0.007575),
  PCB162 = c(0.01005, 0.008123598, 0.006675),
  PCB164 = c(0.25, 0.243458759, 0.16225),
  PCB165 = c(0.01255, 0.010117119, 0.00835),
  PCB167 = c(0.082, 0.070520807, 0.05175),
  PCB169 = c(0.012, 0.010191876, 0.007975),
  PCB170 = c(0.2875, 0.346374284, 0.211),
  `PCB171+173` = c(0.136, 0.134562671, 0.08425),
  PCB172 = c(0.07225, 0.074507849, 0.05025),
  PCB174 = c(0.4975, 0.493396462, 0.315),
  PCB175 = c(0.02035, 0.020333915, 0.012325),
  PCB176 = c(0.07275, 0.07600299, 0.0465),
  PCB177 = c(0.227, 0.20782457, 0.14725),
  PCB178 = c(0.12975, 0.135061052, 0.094),
  PCB179 = c(0.2825, 0.331422876, 0.204),
  `PCB180+193` = c(0.9125, 1.039122851, 0.6425),
  PCB181 = c(0.007325, 0.007874408, 0.0033),
  PCB182 = c(0.00475, 0.002616496, 0.0021375),
  `PCB183+185` = c(0.32, 0.363817593, 0.2195),
  PCB184 = c(0.002155, 0.002741091, 0.0022875),
  PCB186 = c(0.002155, 0.0021231, 0.0021375),
  PCB187 = c(0.76, 0.779965113, 0.38),
  PCB188 = c(0.002155, 0.0021231, 0.003),
  PCB189 = c(0.010075, 0.011487665, 0.00685),
  PCB190 = c(0.0745, 0.068527286, 0.04425),
  PCB191 = c(0.01485, 0.014353352, 0.006825),
  PCB192 = c(0.002155, 0.002434588, 0.0021375),
  PCB194 = c(0.12575, 0.108646898, 0.07825),
  PCB195 = c(0.0495, 0.058808871, 0.03),
  PCB196 = c(0.08575, 0.066782955, 0.04675),
  `PCB197+200` = c(0.0255, 0.029653626, 0.01855),
  `PCB198+199` = c(0.2395, 0.178170944, 0.12675),
  PCB201 = c(0.02925, 0.024570147, 0.012625),
  PCB202 = c(0.04975, 0.047595315, 0.033),
  PCB203 = c(0.159, 0.105656616, 0.084),
  PCB204 = c(0.002155, 0.0021231, 0.0021375),
  PCB205 = c(0.004875, 0.006952405, 0.004425),
  PCB206 = c(0.13575, 0.064789434, 0.055),
  PCB207 = c(0.024475, 0.01440319, 0.0113),
  PCB208 = c(0.059, 0.027909295, 0.017125),
  PCB209 = c(0.04725, 0.045850984, 0.02575),
  stringsAsFactors = FALSE, check.names = FALSE
)

# Prepare profile ---------------------------------------------------------
# Remove metada
wc.3hi <- wc[, 8:166]
# Create average PCB congener profiles
{
  tmp <- rowSums(wc.3hi, na.rm = TRUE)
  prof <- sweep(wc.3hi, 1, tmp, FUN = "/")
  prof.ave <- data.frame(colMeans(prof, na.rm = TRUE))
  colnames(prof.ave) <- c("mean")
  prof.sd <- data.frame(apply(prof, 2, sd, na.rm = TRUE))
  colnames(prof.sd) <- c("sd")
  congener <- row.names(prof.ave)
  prof.ave <- cbind(congener, prof.ave$mean, prof.sd$sd)
  colnames(prof.ave) <- c("congener", "mean", "sd")
  prof.ave <- data.frame(prof.ave)
  prof.ave$mean <- as.numeric(as.character(prof.ave$mean))
  prof.ave$sd <- as.numeric(as.character(prof.ave$sd))
  prof.ave$congener <- as.character(prof.ave$congener)
  #Then turn it back into a factor with the levels in the correct order
  prof.ave$congener <- factor(prof.ave$congener,
                              levels = unique(prof.ave$congener))
  # Save average profile data
  write.csv(prof.ave, file = "Output/Data/csv/AveProf3HWater.csv")
}

# Plot profile ------------------------------------------------------------
waterProfAvg <- ggplot(prof.ave, aes(x = congener, y = mean)) +
  geom_bar(position = position_dodge(), stat = "identity",
           fill = "black") +
  geom_errorbar(aes(ymin = mean, ymax = (mean+sd)), width = 0.9,
                position = position_dodge(0.9)) +
  xlab("") +
  ylim(0, 0.35) +
  theme_classic() +
  theme(aspect.ratio = 4/16) +
  theme(panel.border = element_rect(color =  'black', fill = NA, size = 1.1)) +
  ylab(expression(bold("Concentration Fraction "*Sigma*"PCB"))) +
  theme(axis.text.y = element_text(face = "bold", size = 14),
        axis.title.y = element_text(face = "bold", size = 14)) +
  theme(axis.title.x=element_blank(),
        axis.text.x=element_blank(), 
        axis.ticks.x=element_blank()) +
  annotate("text", x = 4, y = 0.16, label = "PCB 4", size = 5,
           fontface = 1, angle = 90) +
  annotate("text", x = 11, y = 0.1, label = "PCB 11", size = 5,
           fontface = 1, angle = 90) +
  annotate("text", x = 18, y = 0.14, label = "PCB 19", size = 5,
           fontface = 1, angle = 90) +
  annotate("text", x = 38, y = 0.2, label = "PCB 44+47+65", size = 5,
           fontface = 1, angle = 90,vjust=-0.1) +
  annotate("text", x = 39, y = 0.27, label = "PCB 45+51", size = 5,
           fontface = 1, angle = 90, vjust=1.2) +
  annotate("text", x = 44, y = 0.09, label = "PCB 52", size = 5,
           fontface = 1, angle = 90) +
  annotate("text", x = 57, y = 0.11, label = "PCB 68", size = 5,
           fontface = 1, angle = 90) +
  annotate("text", x = 83, y = 0.13, label = "PCB 110+115", size = 5,
           fontface = 1, angle = 90) +
  annotate("text", x = 155, y = 0.3, label = "(B)", size = 5,
           fontface = 1) 

print(waterProfAvg)

# Save plot ---------------------------------------------------------------
ggsave("Output/Plots/WaterProfAvgFig3B3Hight.png", plot = waterProfAvg, width = 10,
       height = 5, dpi = 500)



